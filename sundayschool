<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunday School Attendance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Nunito:wght@400;600;700;800&display=swap');
        body { font-family: 'Nunito', sans-serif; background-color: #f0f9ff; background-image: radial-gradient(#e0f2fe 1px, transparent 1px), radial-gradient(#bae6fd 1px, transparent 1px); background-size: 40px 40px; background-position: 0 0, 20px 20px; overflow-x: hidden; }
        h1, h2, .fun-text { font-family: 'Montserrat', sans-serif; }
        .header { background: linear-gradient(135deg, #60a5fa, #3b82f6, #2563eb, #1d4ed8); background-size: 400% 400%; animation: gradientBG 15s ease infinite; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.5); }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        /* ... Paste ALL other CSS rules from your original file here ... */
    </style>
</head>
<body class="min-h-screen">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        // ============== 1. PASTE YOUR FIREBASE CONFIG HERE ==================
        // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCKATZ1roZhIaAg38bFiU577PxzMyKHc1k",
  authDomain: "sunday-school-pasteur.firebaseapp.com",
  databaseURL: "https://sunday-school-pasteur-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sunday-school-pasteur",
  storageBucket: "sunday-school-pasteur.firebasestorage.app",
  messagingSenderId: "413936353224",
  appId: "1:413936353224:web:0dc6932e6e6b47cba94afd",
  measurementId: "G-7YHHLWJQE5"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        };
        // ====================================================================

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        document.addEventListener('DOMContentLoaded', function() {
            let attendanceData = {}; // This will now be populated from Firebase

            // Sets up a real-time connection to Firebase
            function setupFirebaseListeners() {
                database.ref('attendance').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        attendanceData = data;
                    } else {
                        // If the database is empty, create a default structure
                        attendanceData = { students: [], dates: [], records: {} };
                    }
                    renderTable();
                });
                
                database.ref('history').on('value', (snapshot) => {
                    const historySnapshot = snapshot.val();
                    const historyData = historySnapshot ? Object.values(historySnapshot) : [];
                    renderHistory(historyData);
                });
            }

            // Saves data to Firebase so all devices can see it
            function saveData() {
                database.ref('attendance').set(attendanceData);
            }
            
            // Saves a snapshot to the online history
            function saveSnapshot() {
                const timestamp = new Date().toISOString();
                const newHistoryRef = database.ref('history').push();
                const snapshot = {
                    id: newHistoryRef.key,
                    timestamp: timestamp,
                    data: JSON.parse(JSON.stringify(attendanceData))
                };
                newHistoryRef.set(snapshot);
                showAnimalSticker(window.innerWidth / 2, window.innerHeight / 2);
            }

            function deleteHistory(historyId) {
                database.ref('history/' + historyId).remove();
            }

            function restoreHistory(historyId) {
                database.ref('history/' + historyId).once('value', (snapshot) => {
                    const historyItem = snapshot.val();
                    if (historyItem && historyItem.data) {
                        database.ref('attendance').set(historyItem.data);
                    }
                });
            }

            // --- ALL YOUR OTHER JAVASCRIPT FUNCTIONS (renderTable, addStudent, etc.) ---
            // --- They remain the same and will now work with the live data ---

            // Hook up the new saveSnapshot function to the button
            const saveSnapshotBtn = document.getElementById('save-snapshot-btn');
            saveSnapshotBtn.addEventListener('click', saveSnapshot);

            // Start the application by listening for data from Firebase
            setupFirebaseListeners();
        });
    </script>
</body>
</html>
